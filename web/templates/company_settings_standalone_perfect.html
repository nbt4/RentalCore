<!DOCTYPE html>
<html lang="de" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}} - RentalCore Pro</title>
    
    <!-- Enhanced Meta Tags -->
    <meta name="description" content="Professional Company Settings Management">
    <meta name="theme-color" content="#1e293b">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Optimized CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <link href="/static/css/app-new.css" rel="stylesheet">
    
    <!-- Perfect Custom Styles -->
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --success-gradient: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --card-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --card-shadow-hover: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --border-radius: 16px;
            --border-radius-lg: 20px;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 25%, #334155 100%);
            min-height: 100vh;
            color: #f8fafc;
            line-height: 1.6;
            font-size: 15px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        /* Perfect Navigation */
        .navbar {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .navbar-brand {
            font-weight: 800;
            font-size: 1.5rem;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-link {
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 8px;
            padding: 0.5rem 1rem !important;
            margin: 0 0.25rem;
        }

        .nav-link:hover, .nav-link.active {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-1px);
        }

        /* Perfect Container */
        .main-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }

        /* Perfect Header */
        .page-header {
            text-align: center;
            margin-bottom: 3rem;
            position: relative;
        }

        .page-header::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 200px;
            height: 200px;
            background: var(--primary-gradient);
            border-radius: 50%;
            opacity: 0.1;
            filter: blur(40px);
            z-index: -1;
        }

        .page-title {
            font-size: 3rem;
            font-weight: 900;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
            letter-spacing: -0.02em;
        }

        .page-subtitle {
            font-size: 1.125rem;
            color: #94a3b8;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Perfect Cards */
        .perfect-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius-lg);
            box-shadow: var(--card-shadow);
            backdrop-filter: blur(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }

        .perfect-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: var(--primary-gradient);
            opacity: 0.6;
        }

        .perfect-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--card-shadow-hover);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .card-header-perfect {
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding: 1.5rem 2rem;
            position: relative;
        }

        .card-header-perfect::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 2rem;
            right: 2rem;
            height: 1px;
            background: var(--primary-gradient);
            opacity: 0.3;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #f8fafc;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .section-icon {
            width: 28px;
            height: 28px;
            background: var(--primary-gradient);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
        }

        /* Perfect Form Sections */
        .form-section {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.06);
            position: relative;
        }

        .form-section:last-child {
            border-bottom: none;
        }

        .form-section-header {
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.08);
        }

        .form-section-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: #e2e8f0;
            margin: 0;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .form-section-description {
            font-size: 0.875rem;
            color: #94a3b8;
            margin: 0.5rem 0 0 2.25rem;
        }

        /* Perfect Form Controls */
        .form-floating {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .form-control {
            background: rgba(255, 255, 255, 0.05);
            border: 2px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: #f8fafc;
            font-size: 15px;
            font-weight: 500;
            padding: 1rem 1rem 1rem 1rem;
            height: auto;
            min-height: 56px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .form-control:focus {
            background: rgba(255, 255, 255, 0.08);
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            color: #f8fafc;
            transform: translateY(-1px);
        }

        .form-control::placeholder {
            color: #64748b;
            opacity: 1;
        }

        .form-floating > label {
            background: rgba(15, 23, 42, 0.9);
            color: #94a3b8;
            font-weight: 500;
            font-size: 14px;
            padding: 0.375rem 0.75rem;
            border-radius: 6px;
            margin-left: 0.5rem;
            transition: all 0.3s ease;
        }

        .form-floating > .form-control:focus ~ label,
        .form-floating > .form-control:not(:placeholder-shown) ~ label {
            color: #667eea;
            transform: scale(0.85) translateY(-0.5rem) translateX(0.15rem);
        }

        .form-control.is-valid {
            border-color: #22c55e;
            background: rgba(34, 197, 94, 0.05);
        }

        .form-control.is-invalid {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        /* Perfect Buttons */
        .btn-perfect {
            background: var(--primary-gradient);
            border: none;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            font-size: 15px;
            padding: 1rem 2rem;
            text-transform: none;
            letter-spacing: 0.025em;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-perfect::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .btn-perfect:hover::before {
            left: 100%;
        }

        .btn-perfect:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
        }

        .btn-perfect:active {
            transform: translateY(0);
        }

        .btn-secondary-perfect {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            color: #f8fafc;
        }

        .btn-secondary-perfect:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
            color: #f8fafc;
        }

        /* Perfect Messages */
        .message-container {
            position: fixed;
            top: 100px;
            right: 2rem;
            z-index: 1050;
            max-width: 400px;
        }

        .alert-perfect {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(20px);
            color: #1e293b;
            padding: 1.5rem;
            animation: slideIn 0.3s ease-out;
        }

        .alert-success-perfect {
            background: rgba(34, 197, 94, 0.95);
            color: white;
        }

        .alert-error-perfect {
            background: rgba(239, 68, 68, 0.95);
            color: white;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Perfect Logo Upload */
        .logo-upload-area {
            border: 2px dashed rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 2rem;
            text-align: center;
            transition: all 0.3s ease;
            background: rgba(255, 255, 255, 0.02);
        }

        .logo-upload-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .logo-preview-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .logo-preview-image {
            max-height: 100px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        /* Perfect Action Bar */
        .action-bar {
            background: rgba(255, 255, 255, 0.05);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            margin: 0 -2rem -2rem;
            border-radius: 0 0 var(--border-radius-lg) var(--border-radius-lg);
        }

        /* Perfect Responsive */
        @media (max-width: 768px) {
            .main-container {
                padding: 1rem 0.5rem;
            }

            .page-title {
                font-size: 2rem;
            }

            .form-section {
                padding: 1.5rem 1rem;
            }

            .action-bar {
                margin: 0 -1rem -1rem;
                padding: 1.5rem 1rem;
            }

            .message-container {
                left: 1rem;
                right: 1rem;
                max-width: none;
            }
        }

        /* Perfect Animations */
        .animate-fade-in {
            animation: fadeIn 0.6s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Perfect Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* Perfect Modal */
        .modal-content {
            background: rgba(15, 23, 42, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: var(--border-radius);
            backdrop-filter: blur(20px);
        }

        .modal-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .modal-footer {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* Perfect Form Grid */
        .form-grid {
            display: grid;
            gap: 1.5rem;
        }

        .form-grid-2 {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }

        .form-grid-3 {
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        }

        /* Perfect Status Indicators */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            font-weight: 500;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #22c55e;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body class="animate-fade-in">
    <!-- Perfect Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-gear-wide-connected me-2"></i>RentalCore Pro
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav me-auto">
                    <a class="nav-link" href="/jobs"><i class="bi bi-briefcase me-1"></i>Jobs</a>
                    <a class="nav-link" href="/devices"><i class="bi bi-cpu me-1"></i>Geräte</a>
                    <a class="nav-link" href="/customers"><i class="bi bi-people me-1"></i>Kunden</a>
                    <a class="nav-link active" href="/settings/company"><i class="bi bi-building me-1"></i>Unternehmen</a>
                </div>
                <div class="navbar-nav">
                    {{if .user}}
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="bi bi-person-circle me-1"></i>{{.user.Username}}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="/logout"><i class="bi bi-box-arrow-right me-2"></i>Abmelden</a></li>
                        </ul>
                    </div>
                    {{end}}
                </div>
            </div>
        </div>
    </nav>

    <!-- Perfect Main Container -->
    <div class="main-container">
        <!-- Perfect Header -->
        <div class="page-header">
            <h1 class="page-title">Firmeneinstellungen</h1>
            <p class="page-subtitle">Verwalten Sie Ihre Unternehmensdaten professionell und effizient</p>
        </div>

        <!-- Perfect Message Container -->
        <div id="messageContainer" class="message-container" style="display: none;">
            <div class="alert alert-perfect" role="alert">
                <div class="d-flex align-items-center">
                    <i class="bi me-2" id="messageIcon"></i>
                    <span id="messageText"></span>
                </div>
            </div>
        </div>

        <!-- Perfect Main Card -->
        <div class="perfect-card">
            <div class="card-header-perfect">
                <h2 class="section-title">
                    <div class="section-icon">
                        <i class="bi bi-building"></i>
                    </div>
                    Unternehmensdaten
                </h2>
            </div>

            <form id="companySettingsForm" enctype="multipart/form-data">
                <!-- Basic Information Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-info-circle text-primary"></i>
                            Grunddaten
                        </h3>
                        <p class="form-section-description">Grundlegende Informationen über Ihr Unternehmen</p>
                    </div>
                    
                    <div class="form-grid form-grid-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="companyName" name="companyName" placeholder="Firmenname" required>
                            <label for="companyName">Firmenname *</label>
                        </div>
                    </div>
                </div>

                <!-- Address Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-geo-alt text-primary"></i>
                            Anschrift
                        </h3>
                        <p class="form-section-description">Vollständige Firmenadresse für Rechnungen und Korrespondenz</p>
                    </div>
                    
                    <div class="form-grid form-grid-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="addressLine1" name="addressLine1" placeholder="Straße und Hausnummer">
                            <label for="addressLine1">Straße und Hausnummer</label>
                        </div>
                        <div class="form-floating">
                            <input type="text" class="form-control" id="addressLine2" name="addressLine2" placeholder="Adresszusatz">
                            <label for="addressLine2">Adresszusatz</label>
                        </div>
                    </div>
                    
                    <div class="form-grid form-grid-3">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="postalCode" name="postalCode" placeholder="PLZ">
                            <label for="postalCode">PLZ</label>
                        </div>
                        <div class="form-floating">
                            <input type="text" class="form-control" id="city" name="city" placeholder="Stadt">
                            <label for="city">Stadt</label>
                        </div>
                        <div class="form-floating">
                            <input type="text" class="form-control" id="state" name="state" placeholder="Bundesland">
                            <label for="state">Bundesland</label>
                        </div>
                    </div>
                    
                    <div class="form-grid form-grid-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="country" name="country" placeholder="Land" value="Deutschland">
                            <label for="country">Land</label>
                        </div>
                    </div>
                </div>

                <!-- Contact Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-telephone text-primary"></i>
                            Kontaktdaten
                        </h3>
                        <p class="form-section-description">Kommunikationskanäle für Kunden und Partner</p>
                    </div>
                    
                    <div class="form-grid form-grid-2">
                        <div class="form-floating">
                            <input type="tel" class="form-control" id="phone" name="phone" placeholder="Telefon">
                            <label for="phone">Telefon</label>
                        </div>
                        <div class="form-floating">
                            <input type="email" class="form-control" id="email" name="email" placeholder="E-Mail">
                            <label for="email">E-Mail</label>
                        </div>
                    </div>
                    
                    <div class="form-floating">
                        <input type="url" class="form-control" id="website" name="website" placeholder="Website">
                        <label for="website">Website</label>
                    </div>
                </div>

                <!-- Tax Information Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-receipt text-primary"></i>
                            Steuerinformationen
                        </h3>
                        <p class="form-section-description">Steuerliche Identifikationsnummern für die Rechnungsstellung</p>
                    </div>
                    
                    <div class="form-grid form-grid-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="taxNumber" name="taxNumber" placeholder="Steuernummer">
                            <label for="taxNumber">Steuernummer</label>
                        </div>
                        <div class="form-floating">
                            <input type="text" class="form-control" id="vatNumber" name="vatNumber" placeholder="USt-IdNr.">
                            <label for="vatNumber">USt-IdNr.</label>
                        </div>
                    </div>
                </div>

                <!-- Banking Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-bank text-primary"></i>
                            Bankverbindung
                        </h3>
                        <p class="form-section-description">Zahlungsinformationen für Rechnungen und Überweisungen</p>
                    </div>
                    
                    <div class="form-floating">
                        <input type="text" class="form-control" id="bankName" name="bankName" placeholder="Bank">
                        <label for="bankName">Bankname</label>
                    </div>
                    
                    <div class="form-grid form-grid-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="iban" name="iban" placeholder="IBAN" data-type="iban">
                            <label for="iban">IBAN</label>
                        </div>
                        <div class="form-floating">
                            <input type="text" class="form-control" id="bic" name="bic" placeholder="BIC">
                            <label for="bic">BIC</label>
                        </div>
                    </div>
                    
                    <div class="form-floating">
                        <input type="text" class="form-control" id="accountHolder" name="accountHolder" placeholder="Kontoinhaber">
                        <label for="accountHolder">Kontoinhaber</label>
                    </div>
                </div>

                <!-- Legal Information Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-shield-check text-primary"></i>
                            Rechtliche Angaben
                        </h3>
                        <p class="form-section-description">Gesetzlich vorgeschriebene Unternehmensangaben</p>
                    </div>
                    
                    <div class="form-floating">
                        <input type="text" class="form-control" id="ceoName" name="ceoName" placeholder="Geschäftsführer">
                        <label for="ceoName">Geschäftsführer</label>
                    </div>
                    
                    <div class="form-grid form-grid-2">
                        <div class="form-floating">
                            <input type="text" class="form-control" id="registerCourt" name="registerCourt" placeholder="Registergericht">
                            <label for="registerCourt">Registergericht</label>
                        </div>
                        <div class="form-floating">
                            <input type="text" class="form-control" id="registerNumber" name="registerNumber" placeholder="Handelsregisternummer">
                            <label for="registerNumber">Handelsregisternummer</label>
                        </div>
                    </div>
                </div>

                <!-- Logo Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-image text-primary"></i>
                            Firmenlogo
                        </h3>
                        <p class="form-section-description">Professionelles Logo für Rechnungen und Dokumente</p>
                    </div>
                    
                    <div id="logoUpload" class="logo-upload-area">
                        <i class="bi bi-cloud-upload text-primary" style="font-size: 2rem; margin-bottom: 1rem;"></i>
                        <h4>Logo hochladen</h4>
                        <p class="text-muted mb-3">Ziehen Sie eine Datei hierher oder klicken Sie zum Auswählen</p>
                        <input class="form-control" type="file" id="logoFile" name="logoFile" accept="image/*" style="display: none;">
                        <button type="button" class="btn btn-secondary-perfect" onclick="document.getElementById('logoFile').click()">
                            <i class="bi bi-upload me-2"></i>Datei auswählen
                        </button>
                        <div class="mt-2">
                            <small class="text-muted">Maximale Dateigröße: 2MB • Formate: JPG, PNG, GIF</small>
                        </div>
                    </div>
                    
                    <div id="logoPreview" class="logo-preview-container" style="display: none;">
                        <img id="logoImg" src="" alt="Company Logo" class="logo-preview-image mb-3">
                        <div>
                            <button type="button" class="btn btn-outline-danger" onclick="removeLogo()">
                                <i class="bi bi-trash me-2"></i>Logo entfernen
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Invoice Text Section -->
                <div class="form-section">
                    <div class="form-section-header">
                        <h3 class="form-section-title">
                            <i class="bi bi-file-text text-primary"></i>
                            Rechnungstexte
                        </h3>
                        <p class="form-section-description">Standardtexte für Ihre Rechnungen und Dokumente</p>
                    </div>
                    
                    <div class="form-floating mb-3">
                        <textarea class="form-control" id="footerText" name="footerText" placeholder="Fußtext für Rechnungen" style="min-height: 120px;"></textarea>
                        <label for="footerText">Fußtext für Rechnungen</label>
                    </div>
                    
                    <div class="form-floating">
                        <textarea class="form-control" id="paymentTermsText" name="paymentTermsText" placeholder="Zahlungsbedingungen" style="min-height: 120px;"></textarea>
                        <label for="paymentTermsText">Zahlungsbedingungen</label>
                    </div>
                </div>

                <!-- Perfect Action Bar -->
                <div class="action-bar">
                    <div class="d-flex gap-3 justify-content-end align-items-center">
                        <div class="status-indicator me-auto">
                            <div class="status-dot"></div>
                            <span>System bereit</span>
                        </div>
                        
                        <button type="button" class="btn btn-secondary-perfect" onclick="previewCompanyInfo()">
                            <i class="bi bi-eye me-2"></i>Vorschau
                        </button>
                        
                        <button type="submit" class="btn btn-perfect" id="saveButton">
                            <i class="bi bi-check-lg me-2"></i>Einstellungen speichern
                        </button>
                    </div>
                    
                    <div class="text-center mt-3">
                        <small class="text-muted">
                            <i class="bi bi-keyboard me-1"></i>
                            Tastenkürzel: <kbd>Strg + S</kbd> zum Speichern
                        </small>
                    </div>
                </div>
            </form>
        </div>

        <!-- Perfect Back Button -->
        <div class="text-center mt-4">
            <a href="/" class="btn btn-secondary-perfect">
                <i class="bi bi-arrow-left me-2"></i>Zurück zum Dashboard
            </a>
        </div>
    </div>

    <!-- Perfect Preview Modal -->
    <div class="modal fade" id="previewModal" tabindex="-1" aria-labelledby="previewModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="previewModalLabel">
                        <i class="bi bi-eye me-2"></i>Vorschau Firmeninformationen
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div id="companyPreview"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary-perfect" data-bs-dismiss="modal">Schließen</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Perfect Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script>
        // Perfect form initialization
        document.addEventListener('DOMContentLoaded', function() {
            initializeCompanySettings();
            setupFormHandlers();
            setupEnhancements();
        });

        function setupFormHandlers() {
            // Form submission
            const form = document.getElementById('companySettingsForm');
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                submitCompanySettings();
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                if (e.ctrlKey && e.key === 's') {
                    e.preventDefault();
                    submitCompanySettings();
                }
            });

            // IBAN formatting
            const ibanInput = document.getElementById('iban');
            if (ibanInput) {
                ibanInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\s/g, '').toUpperCase();
                    let formattedValue = value.match(/.{1,4}/g)?.join(' ') || value;
                    if (formattedValue !== e.target.value) {
                        e.target.value = formattedValue;
                    }
                });
            }

            // Logo file input
            const logoFileInput = document.getElementById('logoFile');
            logoFileInput.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    previewLogoFile(file);
                }
            });
        }

        function setupEnhancements() {
            // Form validation feedback
            const inputs = document.querySelectorAll('.form-control');
            inputs.forEach(input => {
                input.addEventListener('blur', function() {
                    validateField(this);
                });
                
                input.addEventListener('input', function() {
                    if (this.classList.contains('is-invalid')) {
                        validateField(this);
                    }
                });
            });

            // Drag and drop for logo
            const logoUpload = document.getElementById('logoUpload');
            logoUpload.addEventListener('dragover', function(e) {
                e.preventDefault();
                this.style.borderColor = '#667eea';
                this.style.backgroundColor = 'rgba(102, 126, 234, 0.1)';
            });
            
            logoUpload.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                this.style.backgroundColor = 'rgba(255, 255, 255, 0.02)';
            });
            
            logoUpload.addEventListener('drop', function(e) {
                e.preventDefault();
                this.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                this.style.backgroundColor = 'rgba(255, 255, 255, 0.02)';
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    const logoFileInput = document.getElementById('logoFile');
                    logoFileInput.files = files;
                    previewLogoFile(files[0]);
                }
            });
        }

        function validateField(field) {
            const value = field.value.trim();
            const isRequired = field.hasAttribute('required');
            
            field.classList.remove('is-valid', 'is-invalid');
            
            if (isRequired && !value) {
                field.classList.add('is-invalid');
                return false;
            }
            
            // Email validation
            if (field.type === 'email' && value) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    field.classList.add('is-invalid');
                    return false;
                }
            }
            
            // URL validation
            if (field.type === 'url' && value) {
                try {
                    new URL(value);
                } catch {
                    field.classList.add('is-invalid');
                    return false;
                }
            }
            
            if (value) {
                field.classList.add('is-valid');
            }
            
            return true;
        }

        function previewLogoFile(file) {
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const logoPreview = document.getElementById('logoPreview');
                    const logoImg = document.getElementById('logoImg');
                    const logoUpload = document.getElementById('logoUpload');
                    
                    logoImg.src = e.target.result;
                    logoPreview.style.display = 'block';
                    logoUpload.style.display = 'none';
                };
                reader.readAsDataURL(file);
            }
        }

        function showMessage(message, type) {
            const messageContainer = document.getElementById('messageContainer');
            const messageText = document.getElementById('messageText');
            const messageIcon = document.getElementById('messageIcon');
            const alert = messageContainer.querySelector('.alert');
            
            // Reset classes
            alert.className = 'alert alert-perfect';
            messageIcon.className = 'bi me-2';
            
            // Set type-specific classes and icons
            if (type === 'success') {
                alert.classList.add('alert-success-perfect');
                messageIcon.classList.add('bi-check-circle-fill');
            } else if (type === 'error') {
                alert.classList.add('alert-error-perfect');
                messageIcon.classList.add('bi-exclamation-triangle-fill');
            } else {
                messageIcon.classList.add('bi-info-circle-fill');
            }
            
            messageText.textContent = message;
            messageContainer.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                messageContainer.style.display = 'none';
            }, 5000);
        }

        function removeLogo() {
            if (confirm('Sind Sie sicher, dass Sie das Firmenlogo entfernen möchten?')) {
                fetch('/settings/company/logo', {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        document.getElementById('logoPreview').style.display = 'none';
                        document.getElementById('logoUpload').style.display = 'block';
                        showMessage('Logo erfolgreich entfernt', 'success');
                    } else {
                        showMessage('Fehler beim Entfernen des Logos: ' + (data.error || 'Unbekannter Fehler'), 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('Fehler beim Entfernen des Logos', 'error');
                });
            }
        }

        function submitCompanySettings() {
            const saveButton = document.getElementById('saveButton');
            const originalText = saveButton.innerHTML;
            
            // Show loading state
            saveButton.disabled = true;
            saveButton.innerHTML = '<div class="loading-spinner me-2"></div>Speichern...';
            
            const formData = new FormData(document.getElementById('companySettingsForm'));
            
            // Convert FormData to JSON for non-file fields
            const company = {
                companyName: formData.get('companyName') || '',
                addressLine1: formData.get('addressLine1') || '',
                addressLine2: formData.get('addressLine2') || '',
                city: formData.get('city') || '',
                state: formData.get('state') || '',
                postalCode: formData.get('postalCode') || '',
                country: formData.get('country') || '',
                phone: formData.get('phone') || '',
                email: formData.get('email') || '',
                website: formData.get('website') || '',
                taxNumber: formData.get('taxNumber') || '',
                vatNumber: formData.get('vatNumber') || '',
                bankName: formData.get('bankName') || '',
                iban: formData.get('iban') || '',
                bic: formData.get('bic') || '',
                accountHolder: formData.get('accountHolder') || '',
                ceoName: formData.get('ceoName') || '',
                registerCourt: formData.get('registerCourt') || '',
                registerNumber: formData.get('registerNumber') || '',
                footerText: formData.get('footerText') || '',
                paymentTermsText: formData.get('paymentTermsText') || ''
            };
            
            // Handle logo upload if present
            const logoFile = formData.get('logoFile');
            if (logoFile && logoFile.size > 0) {
                const logoFormData = new FormData();
                logoFormData.append('logo', logoFile);
                
                fetch('/settings/company/logo', {
                    method: 'POST',
                    body: logoFormData
                })
                .then(response => response.json())
                .then(data => {
                    if (data.error) {
                        showMessage('Fehler beim Hochladen des Logos: ' + data.error, 'error');
                        saveButton.disabled = false;
                        saveButton.innerHTML = originalText;
                    } else {
                        company.logoPath = data.logoPath;
                        updateCompanySettings(company, saveButton, originalText);
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showMessage('Fehler beim Hochladen des Logos', 'error');
                    saveButton.disabled = false;
                    saveButton.innerHTML = originalText;
                });
            } else {
                updateCompanySettings(company, saveButton, originalText);
            }
        }

        function updateCompanySettings(company, saveButton, originalText) {
            fetch('/settings/company/api', {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(company)
            })
            .then(response => response.json())
            .then(data => {
                saveButton.disabled = false;
                saveButton.innerHTML = originalText;
                
                if (data.error) {
                    showMessage('Fehler beim Speichern: ' + data.error, 'error');
                } else {
                    showMessage('Firmeneinstellungen erfolgreich gespeichert!', 'success');
                    // Scroll to top to show success message
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                }
            })
            .catch(error => {
                console.error('Error:', error);
                saveButton.disabled = false;
                saveButton.innerHTML = originalText;
                showMessage('Fehler beim Speichern der Einstellungen', 'error');
            });
        }

        function previewCompanyInfo() {
            const company = {
                companyName: document.getElementById('companyName').value,
                addressLine1: document.getElementById('addressLine1').value,
                addressLine2: document.getElementById('addressLine2').value,
                city: document.getElementById('city').value,
                state: document.getElementById('state').value,
                postalCode: document.getElementById('postalCode').value,
                country: document.getElementById('country').value,
                phone: document.getElementById('phone').value,
                email: document.getElementById('email').value,
                website: document.getElementById('website').value,
                taxNumber: document.getElementById('taxNumber').value,
                vatNumber: document.getElementById('vatNumber').value,
                bankName: document.getElementById('bankName').value,
                iban: document.getElementById('iban').value,
                bic: document.getElementById('bic').value,
                accountHolder: document.getElementById('accountHolder').value,
                ceoName: document.getElementById('ceoName').value,
                registerCourt: document.getElementById('registerCourt').value,
                registerNumber: document.getElementById('registerNumber').value,
                footerText: document.getElementById('footerText').value,
                paymentTermsText: document.getElementById('paymentTermsText').value
            };
            
            let previewHTML = '<div style="background: white; color: #333; padding: 2rem; border-radius: 12px;">';
            
            // Logo section
            {{if .company.LogoPath}}
            previewHTML += '<div style="text-align: center; margin-bottom: 2rem;"><img src="{{.company.LogoPath}}" alt="' + company.companyName + '" style="max-height: 80px;" /></div>';
            {{end}}
            
            // Company header
            previewHTML += '<div style="text-align: center; margin-bottom: 2rem;">';
            previewHTML += '<h2 style="color: #1e293b; margin-bottom: 0.5rem;">' + (company.companyName || 'Firmenname') + '</h2>';
            previewHTML += '</div>';
            
            // Address and contact in grid
            previewHTML += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 2rem;">';
            
            // Address section
            previewHTML += '<div>';
            previewHTML += '<h4 style="color: #667eea; margin-bottom: 1rem;">Anschrift</h4>';
            if (company.addressLine1) previewHTML += '<div>' + company.addressLine1 + '</div>';
            if (company.addressLine2) previewHTML += '<div>' + company.addressLine2 + '</div>';
            if (company.postalCode || company.city) {
                previewHTML += '<div>' + (company.postalCode || '') + ' ' + (company.city || '') + '</div>';
            }
            if (company.country) previewHTML += '<div>' + company.country + '</div>';
            previewHTML += '</div>';
            
            // Contact section
            previewHTML += '<div>';
            previewHTML += '<h4 style="color: #667eea; margin-bottom: 1rem;">Kontakt</h4>';
            if (company.phone) previewHTML += '<div><strong>Tel:</strong> ' + company.phone + '</div>';
            if (company.email) previewHTML += '<div><strong>E-Mail:</strong> ' + company.email + '</div>';
            if (company.website) previewHTML += '<div><strong>Web:</strong> ' + company.website + '</div>';
            previewHTML += '</div>';
            
            previewHTML += '</div>';
            
            // Additional info
            if (company.bankName || company.iban || company.taxNumber || company.vatNumber) {
                previewHTML += '<div style="border-top: 1px solid #e2e8f0; padding-top: 1rem; text-align: center;">';
                previewHTML += '<small style="color: #64748b;">';
                
                if (company.taxNumber) previewHTML += '<strong>Steuernr.:</strong> ' + company.taxNumber + ' ';
                if (company.vatNumber) previewHTML += '<strong>USt-IdNr.:</strong> ' + company.vatNumber + ' ';
                if (company.bankName) previewHTML += '<strong>Bank:</strong> ' + company.bankName + ' ';
                if (company.iban) previewHTML += '<strong>IBAN:</strong> ' + company.iban;
                
                previewHTML += '</small></div>';
            }
            
            previewHTML += '</div>';
            
            document.getElementById('companyPreview').innerHTML = previewHTML;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('previewModal'));
            modal.show();
        }

        function initializeCompanySettings() {
            loadCompanySettings();
        }

        function loadCompanySettings() {
            fetch('/settings/company/api', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json',
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success && data.company) {
                    populateForm(data.company);
                } else {
                    console.error('Failed to load company settings:', data.error);
                }
            })
            .catch(error => {
                console.error('Error loading company settings:', error);
            });
        }

        function populateForm(company) {
            // Basic company information
            setFieldValue('companyName', company.companyName);
            setFieldValue('addressLine1', company.addressLine1);
            setFieldValue('addressLine2', company.addressLine2);
            setFieldValue('city', company.city);
            setFieldValue('state', company.state);
            setFieldValue('postalCode', company.postalCode);
            setFieldValue('country', company.country);
            setFieldValue('phone', company.phone);
            setFieldValue('email', company.email);
            setFieldValue('website', company.website);
            setFieldValue('taxNumber', company.taxNumber);
            setFieldValue('vatNumber', company.vatNumber);
            
            // Banking information
            setFieldValue('bankName', company.bankName);
            setFieldValue('iban', company.iban);
            setFieldValue('bic', company.bic);
            setFieldValue('accountHolder', company.accountHolder);
            
            // Legal information
            setFieldValue('ceoName', company.ceoName);
            setFieldValue('registerCourt', company.registerCourt);
            setFieldValue('registerNumber', company.registerNumber);
            
            // Invoice text fields
            setFieldValue('footerText', company.footerText);
            setFieldValue('paymentTermsText', company.paymentTermsText);
            
            // Update logo display if exists
            if (company.logoPath) {
                const logoPreview = document.getElementById('logoPreview');
                const logoImg = document.getElementById('logoImg');
                const logoUpload = document.getElementById('logoUpload');
                
                if (logoPreview && logoImg) {
                    logoImg.src = company.logoPath;
                    logoPreview.style.display = 'block';
                    logoUpload.style.display = 'none';
                }
            }
        }

        function setFieldValue(fieldId, value) {
            const field = document.getElementById(fieldId);
            if (field && value !== null && value !== undefined) {
                field.value = value;
            }
        }
    </script>
</body>
</html>