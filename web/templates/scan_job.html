<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>{{.title}} - RentalCore</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json">
    
    <!-- iOS Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="JobScanner">
    <link rel="apple-touch-icon" href="/static/images/icon-180.png">
    
    <!-- Theme Colors -->
    <meta name="theme-color" content="#030712">
    <meta name="msapplication-TileColor" content="#030712">
    
    <!-- CSS -->
    <link rel="stylesheet" href="/static/css/rental-core-design.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500;600&display=swap" rel="stylesheet">
    
    <style>
        /* Professional Scanner Styles */
        .scanner-container {
            position: relative;
            background: #000;
            border-radius: 16px;
            overflow: hidden;
            margin: 0 auto;
            max-width: 100%;
            width: 100%;
            height: 400px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        @media (min-width: 768px) {
            .scanner-container {
                max-width: 500px;
                height: 380px;
            }
        }
        
        .scanner-video {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            display: block !important;
            background: #000;
        }
        
        /* Force ALL video elements in scanner to be visible */
        .scanner-container video {
            width: 100% !important;
            height: 100% !important;
            object-fit: cover !important;
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            background: black !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            z-index: 1 !important;
        }
        
        /* Ensure modal doesn't interfere with video */
        .modal {
            z-index: 1050 !important;
        }
        
        .modal-backdrop {
            z-index: 1040 !important;
        }
        
        .scanner-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            pointer-events: none;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10;
        }
        
        .scanner-ready {
            border: 4px solid #28a745;
            border-radius: 16px;
            box-shadow: 0 0 20px rgba(40, 167, 69, 0.3);
        }
        
        .scanner-status-area {
            margin: 12px 0;
        }
        
        .scanner-status {
            background: var(--bg-secondary);
            border: 1px solid var(--accent-color);
            color: var(--text-primary);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 500;
            display: inline-block;
            transition: all 0.3s ease;
        }
        
        .scanner-status.code-detected {
            background: rgba(111, 66, 193, 0.1);
            border-color: #6f42c1;
            color: #6f42c1;
            animation: pulse-ready 2s infinite;
        }
        
        @keyframes pulse-ready {
            0% { 
                border-color: #6f42c1;
                box-shadow: 0 0 0 0 rgba(111, 66, 193, 0.7);
            }
            70% {
                border-color: #6f42c1;
                box-shadow: 0 0 0 10px rgba(111, 66, 193, 0);
            }
            100% {
                border-color: #6f42c1;
                box-shadow: 0 0 0 0 rgba(111, 66, 193, 0);
            }
        }
        
        .camera-controls {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-top: 16px;
            position: relative;
            padding-bottom: 40px;
        }
        
        .camera-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }
        
        .camera-btn.start {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }
        
        .camera-btn.start:hover::before {
            content: "Start Camera";
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .camera-btn.stop {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
            animation: pulse-red 2s infinite;
        }
        
        .camera-btn.stop:hover::before {
            content: "Stop Camera";
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2); }
            50% { box-shadow: 0 4px 20px rgba(220, 53, 69, 0.4); }
            100% { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2); }
        }
        
        .camera-status-bar {
            background: rgba(40, 167, 69, 0.1);
            border: 1px solid #28a745;
            border-radius: 8px;
            padding: 8px 16px;
            margin: 16px 0;
            font-size: 14px;
            font-weight: 500;
            color: #28a745;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            background: #28a745;
            border-radius: 50%;
            animation: pulse-green 2s infinite;
        }
        
        @keyframes pulse-green {
            0% { 
                background: #28a745;
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7);
            }
            70% {
                background: #28a745;
                box-shadow: 0 0 0 10px rgba(40, 167, 69, 0);
            }
            100% {
                background: #28a745;
                box-shadow: 0 0 0 0 rgba(40, 167, 69, 0);
            }
        }
        
        .camera-btn.flash {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
        }
        
        .camera-btn.trigger {
            background: linear-gradient(135deg, #6f42c1, #563d7c);
            color: white;
            animation: pulse-trigger 3s infinite;
        }
        
        .camera-btn.trigger:hover::before {
            content: "Scan Trigger (or Spacebar)";
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
        }
        
        .camera-btn.trigger.active {
            animation: pulse-trigger-active 1s infinite;
        }
        
        @keyframes pulse-trigger {
            0% { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2); }
            50% { box-shadow: 0 4px 20px rgba(111, 66, 193, 0.4); }
            100% { box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2); }
        }
        
        @keyframes pulse-trigger-active {
            0% { 
                background: linear-gradient(135deg, #6f42c1, #563d7c);
                box-shadow: 0 4px 16px rgba(111, 66, 193, 0.3);
            }
            50% { 
                background: linear-gradient(135deg, #28a745, #20c997);
                box-shadow: 0 4px 20px rgba(40, 167, 69, 0.6);
            }
            100% { 
                background: linear-gradient(135deg, #6f42c1, #563d7c);
                box-shadow: 0 4px 16px rgba(111, 66, 193, 0.3);
            }
        }
        
        .camera-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        .manual-input-section {
            background: var(--bg-secondary);
            border-radius: 12px;
            padding: 16px;
            margin-top: 16px;
            border: 2px solid var(--accent-color);
        }
        
        .mobile-scanner-section {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 16px;
            border: 1px solid var(--bg-tertiary);
        }
        
        .device-list {
            max-height: 500px;
            overflow-y: auto;
        }
        
        .device-item {
            background: var(--bg-secondary);
            border: 1px solid var(--bg-tertiary);
            border-radius: 8px;
            padding: 16px;
            margin-bottom: 12px;
            transition: all 0.3s ease;
        }
        
        .device-item:hover {
            border-color: var(--accent-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .product-group {
            background: var(--bg-secondary);
            border: 1px solid var(--bg-tertiary);
            border-radius: 8px;
            margin-bottom: 8px;
        }
        
        .product-group .accordion-button {
            background: transparent;
            border: none;
            color: var(--text-primary);
            padding: 12px 16px;
        }
        
        .product-group .accordion-button:not(.collapsed) {
            background: var(--accent-color);
            color: white;
            box-shadow: none;
        }
        
        .product-group .accordion-button:focus {
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25);
            border-color: transparent;
        }
        
        .product-info .product-name {
            font-weight: 600;
            font-size: 16px;
        }
        
        .device-item-grouped {
            background: var(--bg-tertiary);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .device-item-grouped:hover {
            border-color: #dc3545;
            background: rgba(220, 53, 69, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.3);
        }
        
        .product-group:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .device-item-grouped:last-child {
            margin-bottom: 0;
        }
        
        .accordion-body {
            padding: 12px;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .device-id {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 18px;
            color: var(--accent-color);
        }
        
        .device-name {
            color: var(--text-secondary);
            margin-top: 4px;
        }
        
        .device-price {
            color: var(--text-muted);
            font-size: 14px;
            margin-top: 8px;
        }
        
        .job-header {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-tertiary));
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
            border: 2px solid var(--accent-color);
        }
        
        .job-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
        }
        
        .job-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            color: var(--text-muted);
        }
        
        .job-meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        
        .scan-result {
            background: var(--bg-secondary);
            border: 1px solid var(--success-color);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            animation: slideInRight 0.3s ease-out;
        }
        
        .scan-result.error {
            border-color: var(--danger-color);
            background: rgba(220, 53, 69, 0.1);
        }
        
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 40px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--bg-tertiary);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Accordion functionality */
        .rc-accordion-collapse {
            display: none;
            overflow: hidden;
        }
        
        .rc-accordion-collapse.show {
            display: block;
        }
        
        .rc-accordion-button {
            width: 100%;
            text-align: left;
            border: none;
            background: transparent;
            padding: 12px 16px;
            cursor: pointer;
            justify-content: flex-start;
            display: flex;
        }
        
        .rc-accordion-button:not(.collapsed) {
            background: #dc3545;
            color: white;
        }
        
        .rc-accordion-button:hover {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
        }
        
        .rc-accordion-button:not(.collapsed):hover {
            background: #b02a37;
            color: white;
        }
        
        /* CONTROLLED fix - only target problematic > symbols */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            overflow-x: hidden;
        }
        
        /* Only hide specific breadcrumb elements */
        .breadcrumb-separator,
        .breadcrumb-separator::before,
        .breadcrumb-separator::after {
            display: none !important;
        }
        
        /* Keep navbar at top but not fixed */
        .rc-navbar {
            position: relative;
            top: 0;
            margin: 0;
            z-index: 1000;
        }
        
        /* Normal main content */
        main.rc-container {
            margin-top: var(--space-lg);
        }
        
        /* Case scan buttons hover effects */
        .case-scan-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0, 245, 255, 0.2);
            border-color: var(--accent-electric) !important;
            background: var(--surface-2) !important;
        }
        
        .case-scan-btn:hover .bi-box {
            color: var(--accent-neon) !important;
        }
        
        .case-scan-btn:active {
            transform: translateY(0);
        }
    </style>
></head>
<body class="rc-animate-fade-in">
    <!-- Navigation -->
    <nav class="rc-navbar">
        <div class="rc-container">
            <div class="rc-navbar-content">
                <a href="/" class="rc-navbar-brand">
                    <i class="bi bi-gear-wide-connected"></i>
                    RentalCore
                </a>
                
                <!-- Mobile toggle -->
                <button class="rc-navbar-toggle">
                    <i class="bi bi-list"></i>
                </button>
                
                <!-- Main navigation -->
                <ul class="rc-navbar-nav">
                    <li><a href="/jobs" class="rc-nav-link">
                        <i class="bi bi-briefcase"></i> Jobs
                    </a></li>
                    <li><a href="/devices" class="rc-nav-link">
                        <i class="bi bi-cpu"></i> Devices
                    </a></li>
                    <li><a href="/customers" class="rc-nav-link">
                        <i class="bi bi-people"></i> Customers
                    </a></li>
                    <li><a href="/cases" class="rc-nav-link">
                        <i class="bi bi-box"></i> Cases
                    </a></li>
                    
                    <!-- User Info (minimal for scanner) -->
                    {{if .user}}
                    <li><span class="rc-nav-link">
                        <i class="bi bi-person-circle"></i> {{.user.Username}}
                    </span></li>
                    {{end}}
                    
                    <!-- Theme Toggle -->
                    <li>
                        <button class="rc-btn rc-btn-ghost rc-btn-sm" data-theme-toggle title="Toggle theme">
                            <i class="bi bi-moon-fill"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <main class="rc-container rc-mt-lg">
        <!-- Job Header -->
        <div class="rc-flex rc-flex-between rc-mb-xl">
            <div>
                <h1 class="rc-heading-1 rc-mb-sm">{{.job.Description}}</h1>
                <div class="rc-flex rc-flex-gap-md" style="align-items: center;">
                    <span class="rc-text-secondary">
                        <i class="bi bi-person"></i> {{.job.Customer.GetDisplayName}}
                    </span>
                    <span class="rc-text-secondary">
                        <i class="bi bi-calendar"></i> {{if .job.StartDate}}{{.job.StartDate.Format "02.01.2006"}}{{end}}
                    </span>
                    <span class="rc-text-secondary">
                        <i class="bi bi-cpu"></i> {{len .assignedDevices}} devices assigned
                    </span>
                </div>
            </div>
            <div class="rc-flex rc-flex-gap-sm">
                <a href="/scan/select" class="rc-btn rc-btn-outline rc-btn-sm">
                    <i class="bi bi-arrow-left"></i> Change Job
                </a>
                <a href="/jobs/{{.job.JobID}}" class="rc-btn rc-btn-outline rc-btn-sm">
                    <i class="bi bi-eye"></i> View Details
                </a>
            </div>
        </div>

        <div class="rc-grid scanner-layout" style="gap: var(--space-lg); grid-template-columns: 1fr; min-height: 500px;">
            <style>
                @media (min-width: 1024px) {
                    .scanner-layout {
                        grid-template-columns: 1fr 1fr !important;
                    }
                }
            </style>
            <!-- Scanner Column -->
            <div>
                <div class="rc-card" style="border: 2px solid var(--accent-color); box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);">
                    <div class="rc-card-header" style="background: linear-gradient(135deg, var(--accent-color), #8B0000); color: white;">
                        <h3 class="rc-card-title"><i class="bi bi-camera"></i> Barcode Scanner</h3>
                    </div>
                    <div class="rc-card-body">
                        <!-- Camera Scanner Container -->
                        <div class="scanner-container">
                            <div class="loading active" id="camera-loading">
                                <div class="spinner"></div>
                                <p>Click camera button to start continuous scanning</p>
                                <small style="color: #666; margin-top: 10px; display: block;">
                                    📱 Camera requires HTTPS or localhost access
                                </small>
                            </div>
                            <video id="scanner-video" class="scanner-video" autoplay muted playsinline style="display: none;"></video>
                            <div class="scanner-overlay" id="scanner-overlay" style="display: none;">
                                <!-- Overlay content for targeting box, etc. -->
                            </div>
                        </div>
                        
                        <!-- Camera Status Indicator -->
                        <div class="camera-status-bar" id="camera-status-bar" style="display: none;">
                            <div class="rc-flex rc-flex-center">
                                <div class="status-dot"></div>
                                <span class="ms-2">Camera On - Continuous Scanning Active</span>
                            </div>
                        </div>
                        
                        <!-- Scanner Status -->
                        <div class="scanner-status-area rc-text-center" id="scanner-status-area">
                            <div class="scanner-status" id="scanner-status">Ready to scan</div>
                        </div>
                        
                        <!-- Camera Controls -->
                        <div class="camera-controls">
                            <button class="camera-btn start" id="start-btn" onclick="toggleCamera()">
                                <i class="bi bi-camera"></i>
                            </button>
                            <button class="camera-btn stop" id="stop-btn" onclick="toggleCamera()" style="display: none;">
                                <i class="bi bi-stop"></i>
                            </button>
                            <button class="camera-btn trigger" id="trigger-btn" onclick="triggerScan()" style="display: none;">
                                <i class="bi bi-bullseye"></i>
                            </button>
                            <button class="camera-btn flash" id="flash-btn" onclick="toggleFlash()">
                                <i class="bi bi-lightbulb"></i>
                            </button>
                        </div>
                        
                        <!-- Mobile Scanner Options -->
                        <div class="mobile-scanner-section rc-mb-md">
                            <h6><i class="bi bi-phone"></i> Mobile Scanner</h6>
                            <div class="rc-flex rc-flex-gap-sm">
                                <a href="/mobile/scanner/{{.job.JobID}}" class="rc-btn rc-btn-outline rc-btn-sm rc-flex-1">
                                    <i class="bi bi-camera"></i> Standard
                                </a>
                                <a href="/mobile/scanner/{{.job.JobID}}/enhanced" class="rc-btn rc-btn-primary rc-btn-sm rc-flex-1">
                                    <i class="bi bi-stars"></i> Enhanced
                                </a>
                            </div>
                        </div>

                        <!-- Manual Input -->
                        <div class="manual-input-section">
                            <h6><i class="bi bi-keyboard"></i> Manual Input</h6>
                            <div class="rc-input-group">
                                <input type="text" id="manual-input" class="rc-input" 
                                       placeholder="Type device ID (e.g. SUB1001)" autocomplete="off">
                                <button class="rc-btn rc-btn-primary" onclick="processManualInput()">
                                    <i class="bi bi-plus-lg"></i> Add
                                </button>
                            </div>
                            <small class="rc-text-muted rc-mt-sm rc-block">
                                <i class="bi bi-info-circle"></i> Camera not working? Use https:// URL or localhost:9000
                            </small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Cases & Devices Column -->
            <div>
                <!-- Cases Section - Compact -->
                {{if .cases}}
                <div class="rc-card rc-mb-md" style="border: 1px solid var(--bg-tertiary);">
                    <div class="rc-card-header" style="padding: 12px 16px; background: var(--bg-secondary);">
                        <h6 style="margin: 0; font-size: 14px;"><i class="bi bi-box"></i> Quick Scan Cases</h6>
                    </div>
                    <div class="rc-card-body" style="padding: 16px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                            {{range $index, $case := .cases}}
                            {{if lt $index 6}}
                            <button class="rc-btn rc-btn-outline case-scan-btn" onclick="scanCase({{$case.CaseID}}, '{{$case.Name}}', {{len $case.Devices}})" style="font-size: 16px; padding: 20px 12px; min-height: 80px; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; text-align: center; border-radius: 12px; border: 2px solid var(--surface-3); background: var(--surface-1); transition: all 0.2s ease;">
                                <i class="bi bi-box" style="font-size: 24px; color: var(--accent-electric);"></i>
                                <span style="font-weight: 600; color: var(--text-primary);">{{$case.Name}}</span>
                                <small style="color: var(--text-muted); font-size: 12px;">{{len $case.Devices}} devices</small>
                            </button>
                            {{end}}
                            {{end}}
                        </div>
                        {{if gt (len .cases) 6}}
                        <div class="rc-text-center rc-mt-lg">
                            <button class="rc-btn rc-btn-link rc-btn-sm" onclick="toggleAllCases()">
                                <i class="bi bi-chevron-down" id="cases-toggle-icon"></i> +{{sub (len .cases) 6}} more
                            </button>
                        </div>
                        <div id="all-cases" style="display: none;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 24px;">
                                {{range $index, $case := .cases}}
                                {{if ge $index 6}}
                                <button class="rc-btn rc-btn-outline case-scan-btn" onclick="scanCase({{$case.CaseID}}, '{{$case.Name}}', {{len $case.Devices}})" style="font-size: 16px; padding: 20px 12px; min-height: 80px; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 8px; text-align: center; border-radius: 12px; border: 2px solid var(--surface-3); background: var(--surface-1); transition: all 0.2s ease;">
                                    <i class="bi bi-box" style="font-size: 24px; color: var(--accent-electric);"></i>
                                    <span style="font-weight: 600; color: var(--text-primary);">{{$case.Name}}</span>
                                    <small style="color: var(--text-muted); font-size: 12px;">{{len $case.Devices}} devices</small>
                                </button>
                                {{end}}
                                {{end}}
                            </div>
                        </div>
                        {{end}}
                    </div>
                </div>
                {{end}}
                
                <!-- Devices Section -->
                <div class="rc-card">
                    <div class="rc-card-header rc-flex rc-flex-between" style="align-items: center;">
                        <h6><i class="bi bi-list-check"></i> Scanned Devices</h6>
                        <span class="rc-badge rc-badge-primary">{{.totalDevices}} devices</span>
                    </div>
                    <div class="rc-card-body">
                        <div class="device-list" id="device-list">
                            {{if .productGroups}}
                            <div class="rc-accordion" id="deviceAccordion">
                                {{range $productName, $group := .productGroups}}
                                {{$productId := "unknown"}}
                                {{if $group.Product}}{{$productId = printf "%d" $group.Product.ProductID}}{{end}}
                                <div class="rc-accordion-item product-group">
                                    <h2 class="rc-accordion-header" id="heading-product-{{$productId}}">
                                        <button class="rc-accordion-button collapsed" type="button" 
                                                onclick="toggleAccordion('collapse-product-{{$productId}}')" 
                                                aria-expanded="false" 
                                                aria-controls="collapse-product-{{$productId}}">
                                            <div class="rc-flex rc-flex-between rc-w-full rc-mr-sm" style="align-items: center; text-align: left;">
                                                <div class="product-info" style="text-align: left;">
                                                    <div class="product-name">{{$productName}}</div>
                                                    {{if $group.Product.ItemCostPerDay}}
                                                    <small class="rc-text-muted">€{{printf "%.2f" (derefFloat $group.Product.ItemCostPerDay)}} per day</small>
                                                    {{end}}
                                                </div>
                                                <span class="rc-badge rc-badge-secondary">{{len $group.Devices}} devices</span>
                                            </div>
                                        </button>
                                    </h2>
                                    <div id="collapse-product-{{$productId}}" 
                                         class="rc-accordion-collapse collapse" 
                                         aria-labelledby="heading-product-{{$productId}}">
                                        <div class="rc-accordion-body">
                                            {{range $group.Devices}}
                                            <div class="device-item-grouped">
                                                <div class="rc-flex rc-flex-between rc-flex-start">
                                                    <div class="flex-grow-1">
                                                        <div class="device-id">{{.Device.DeviceID}}</div>
                                                        <div class="device-price">
                                                            {{if .CustomPrice}}
                                                                €{{printf "%.2f" (derefFloat .CustomPrice)}} (custom price)
                                                            {{else if .Device.Product.ItemCostPerDay}}
                                                                €{{printf "%.2f" (derefFloat .Device.Product.ItemCostPerDay)}} (default price)
                                                            {{else}}
                                                                No price set
                                                            {{end}}
                                                        </div>
                                                    </div>
                                                    <button class="rc-btn rc-btn-outline-danger rc-btn-sm" onclick="removeDevice('{{.Device.DeviceID}}')">
                                                        <i class="bi bi-trash"></i>
                                                    </button>
                                                </div>
                                            </div>
                                            {{end}}
                                        </div>
                                    </div>
                                </div>
                                {{end}}
                            </div>
                            {{else}}
                            <div class="rc-text-center rc-py-xl" id="empty-state">
                                <i class="bi bi-qr-code rc-text-4xl rc-text-muted"></i>
                                <h5 class="rc-mt-md rc-text-muted">No devices scanned yet</h5>
                                <p class="rc-text-muted">Start scanning to see results here</p>
                            </div>
                            {{end}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Custom Price Modal -->
    <div class="rc-modal" id="priceModal" tabindex="-1" style="display: none;">
        <div class="rc-modal-dialog">
            <div class="rc-modal-content">
                <div class="rc-modal-header">
                    <h5 class="rc-modal-title">Set Custom Price</h5>
                    <button type="button" class="rc-modal-close"></button>
                </div>
                <div class="rc-modal-body">
                    <div class="rc-mb-md">
                        <label class="rc-label">Device</label>
                        <div class="rc-p-md rc-bg-secondary rc-rounded">
                            <div class="device-id" id="modal-device-id">-</div>
                            <div class="device-name" id="modal-device-name">-</div>
                        </div>
                    </div>
                    <div class="rc-mb-md">
                        <label for="customPrice" class="rc-label">Custom Price (EUR)</label>
                        <div class="rc-input-group">
                            <span class="rc-input-group-text">€</span>
                            <input type="number" class="rc-input" id="customPrice" 
                                   placeholder="Leave empty for default" step="0.01" min="0">
                        </div>
                        <div class="rc-form-text" id="default-price-info">
                            Default price will be used if left empty
                        </div>
                    </div>
                </div>
                <div class="rc-modal-footer">
                    <button type="button" class="rc-btn rc-btn-secondary rc-modal-close">Cancel</button>
                    <button type="button" class="rc-btn rc-btn-primary" id="confirm-assign">Assign Device</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/quagga/0.12.1/quagga.min.js"></script>
    
    <script>
        // Global variables
        let isScanning = false;
        let isBulkMode = true;
        let bulkDevices = [];
        let priceModalCallback = null;
        let scanningEnabled = false;
        let lastDetectedCode = null;
        let triggerCooldown = false;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Page loaded');
            console.log('QuaggaJS available:', typeof Quagga !== 'undefined');
            console.log('Navigator mediaDevices available:', !!navigator.mediaDevices);
            console.log('getUserMedia available:', !!navigator.mediaDevices?.getUserMedia);
            
            // Force close any open modals on page load
            const modal = document.getElementById('priceModal');
            if (modal) {
                modal.style.display = 'none';
            }
            
            // TARGETED fix - only remove the specific > text node
            function removeStrayChevron() {
                // Remove any standalone > text nodes
                const walker = document.createTreeWalker(
                    document.body,
                    NodeFilter.SHOW_TEXT,
                    null,
                    false
                );
                
                let node;
                while (node = walker.nextNode()) {
                    if (node.textContent && node.textContent.trim() === '>') {
                        // Remove the text node itself, not the parent
                        node.remove();
                        console.log('Removed stray > text node');
                    }
                }
            }
            
            // Run once to remove the stray >
            setTimeout(removeStrayChevron, 50);
            
            initializeScanner();
            setupEventListeners();
            // toggleBulkMode(); // Disabled - no checkbox present
        });

        function initializeScanner() {
            console.log('Scanner initialized, ready to start');
            // Keep the loading visible with "Click start to begin scanning" message
            // Don't remove 'active' class here - let startScanner() handle it
        }

        function setupEventListeners() {
            // Manual input Enter key
            document.getElementById('manual-input').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    processManualInput();
                }
            });
            
            // Trigger scan with spacebar
            document.addEventListener('keydown', function(e) {
                if (e.code === 'Space' && isScanning) {
                    e.preventDefault();
                    triggerScan();
                }
            });

            // Price modal Enter key
            document.getElementById('customPrice').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    document.getElementById('confirm-assign').click();
                }
            });

            // Confirm assign button
            document.getElementById('confirm-assign').addEventListener('click', function() {
                const customPrice = document.getElementById('customPrice').value;
                const price = customPrice && customPrice.trim() !== '' ? parseFloat(customPrice) : null;
                
                const modal = document.getElementById('priceModal');
                modal.style.display = 'none';
                
                if (priceModalCallback) {
                    priceModalCallback(price);
                    priceModalCallback = null;
                }
            });
        }

        async function startScanner() {
            if (isScanning) return;

            console.log('startScanner() called - using simple camera approach');
            
            // Check if QuaggaJS is loaded
            if (typeof Quagga === 'undefined') {
                updateStatus('QuaggaJS library not loaded', 'error');
                return;
            }

            // Check if camera is available
            if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                console.error('Camera not available - HTTPS required or browser incompatible');
                updateStatus('Camera requires HTTPS or secure connection. Try accessing via https:// or localhost', 'error');
                
                // Reset UI
                document.getElementById('start-btn').style.display = 'block';
                document.getElementById('stop-btn').style.display = 'none';
                return;
            }

            // Update loading message and ensure it's visible
            const loadingDiv = document.getElementById('camera-loading');
            const loadingText = loadingDiv.querySelector('p');
            loadingText.textContent = 'Getting camera stream...';
            loadingDiv.classList.add('active');
            
            const video = document.getElementById('scanner-video');
            
            // Update buttons immediately
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'block';
            
            updateStatus('Starting camera...', 'info');

            try {
                // STEP 1: Get camera stream directly first
                console.log('Getting camera stream manually...');
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        width: { ideal: 640 },
                        height: { ideal: 480 },
                        facingMode: "environment"
                    }
                });
                
                console.log('Got camera stream:', stream);
                
                // STEP 2: Set the stream to our video element
                video.srcObject = stream;
                video.style.display = 'block';
                video.style.visibility = 'visible';
                video.style.opacity = '1';
                
                // STEP 3: Wait for video to load and play
                await new Promise((resolve) => {
                    video.onloadedmetadata = resolve;
                });
                
                await video.play();
                console.log('Video is playing - you should see camera feed now!');
                
                // STEP 4: Show UI immediately since we have working video
                document.getElementById('camera-loading').classList.remove('active');
                document.getElementById('scanner-overlay').style.display = 'block';
                
                // Show camera status bar and trigger button
                document.getElementById('camera-status-bar').style.display = 'block';
                document.getElementById('trigger-btn').style.display = 'block';
                
                // Add ready border to whole container
                const scannerContainer = document.querySelector('.scanner-container');
                scannerContainer.classList.add('scanner-ready');
                
                updateStatus('Camera working! Initializing barcode scanner...', 'success');
                
            } catch (error) {
                console.error('Manual camera failed:', error);
                updateStatus('Camera failed: ' + error.message, 'error');
                
                // Reset UI
                document.getElementById('camera-loading').classList.add('active');
                video.style.display = 'none';
                document.getElementById('scanner-overlay').style.display = 'none';
                document.getElementById('camera-status-bar').style.display = 'none';
                document.getElementById('trigger-btn').style.display = 'none';
                document.getElementById('start-btn').style.display = 'block';
                document.getElementById('stop-btn').style.display = 'none';
                return;
            }

            // STEP 5: Now initialize QuaggaJS with the already-working video
            const config = {
                inputStream: {
                    name: "Live",
                    type: "LiveStream",
                    target: video
                },
                locator: {
                    patchSize: "medium",
                    halfSample: true
                },
                numOfWorkers: 1,
                frequency: 10,
                decoder: {
                    readers: [
                        "code_128_reader",
                        "ean_reader", 
                        "code_39_reader"
                    ]
                },
                locate: true
            };

            console.log('Initializing QuaggaJS with existing video stream...');
            
            // Clear any existing event listeners first
            Quagga.offDetected();
            
            // Set up barcode detection
            Quagga.onDetected(function(result) {
                if (result && result.codeResult && result.codeResult.code) {
                    const code = result.codeResult.code.trim();
                    console.log('Barcode detected:', code);
                    if (code && code.length > 3) {
                        lastDetectedCode = code;
                        updateStatus(`Code detected: ${code} - Press trigger to scan`, 'info');
                        document.getElementById('scanner-status').classList.add('code-detected');
                    }
                }
            });
            
            Quagga.init(config, function(err) {
                if (err) {
                    console.error('QuaggaJS init failed:', err);
                    updateStatus('Scanner initialization failed, but camera is working for manual input', 'warning');
                    return;
                }
                
                console.log('QuaggaJS initialized successfully');
                Quagga.start();
                isScanning = true;
                updateStatus('Point camera at barcode', 'success');
            });
        }

        function toggleCamera() {
            if (isScanning) {
                stopScanner();
            } else {
                startScanner();
            }
        }

        function stopScanner() {
            console.log('Stopping scanner...');
            
            if (isScanning) {
                try {
                    // Remove event listeners first
                    Quagga.offDetected();
                    Quagga.stop();
                    console.log('QuaggaJS stopped');
                } catch (error) {
                    console.error('Error stopping QuaggaJS:', error);
                }
                isScanning = false;
            }
            
            // Clean up camera stream
            const video = document.getElementById('scanner-video');
            if (video.srcObject) {
                video.srcObject.getTracks().forEach(track => {
                    track.stop();
                    console.log('Camera track stopped:', track.label);
                });
                video.srcObject = null;
            }
            
            // Reset UI
            video.style.display = 'none';
            document.getElementById('scanner-overlay').style.display = 'none';
            
            // Hide camera status bar and trigger button
            document.getElementById('camera-status-bar').style.display = 'none';
            document.getElementById('trigger-btn').style.display = 'none';
            
            // Remove ready border
            const scannerContainer = document.querySelector('.scanner-container');
            scannerContainer.classList.remove('scanner-ready');
            
            // Reset loading state and message
            const loadingDiv = document.getElementById('camera-loading');
            const loadingText = loadingDiv.querySelector('p');
            loadingText.textContent = 'Click camera button to start continuous scanning';
            loadingDiv.classList.add('active');
            
            // Update buttons
            document.getElementById('start-btn').style.display = 'block';
            document.getElementById('stop-btn').style.display = 'none';
            
            updateStatus('Camera stopped', 'info');
        }

        function toggleFlash() {
            updateStatus('Flash toggle not available in this version', 'warning');
        }

        function triggerScan() {
            if (triggerCooldown) {
                updateStatus('Please wait...', 'warning');
                return;
            }
            
            if (!lastDetectedCode) {
                updateStatus('No barcode detected - point camera at barcode first', 'warning');
                return;
            }
            
            // Set cooldown to prevent double-scanning
            triggerCooldown = true;
            const triggerBtn = document.getElementById('trigger-btn');
            triggerBtn.classList.add('active');
            
            // Process the last detected code
            processScannedCode(lastDetectedCode);
            
            // Clear the detected code and remove cooldown after 2 seconds
            setTimeout(() => {
                lastDetectedCode = null;
                triggerCooldown = false;
                triggerBtn.classList.remove('active');
                document.getElementById('scanner-status').classList.remove('code-detected');
                updateStatus('Point camera at barcode', 'success');
            }, 2000);
        }

        async function processScannedCode(code) {
            updateStatus('Checking...', 'info');
            
            // Check if this is a case barcode (starts with 'CASE:' or is just a number that could be a case ID)
            if (code.startsWith('CASE:') || /^\d+$/.test(code)) {
                await processCaseCode(code);
                return;
            }
            
            // Validate device exists
            const device = await validateDevice(code);
            if (!device) {
                updateStatus('Device not found: ' + code, 'error');
                addScanResult(code, 'error', 'Device not found');
                
                // Camera stays on regardless of error
                setTimeout(() => {
                    updateStatus('Ready for next scan', 'success');
                }, 2000);
                return;
            }
            
            if (isBulkMode) {
                // Bulk mode (default) - add to bulk list
                bulkDevices.push({
                    deviceId: code,
                    deviceName: device.product ? device.product.name : 'Unknown Product',
                    defaultPrice: device.product ? device.product.itemcostperday : null
                });
                
                addScanResult(code, 'success', `Added to bulk (${bulkDevices.length})`);
                updateStatus(`${bulkDevices.length} devices scanned`, 'success');
                // Keep scanning in bulk mode
            } else {
                // Custom price mode - show price modal
                // Camera stays on - just show modal over it
                
                // Show price modal
                showPriceModal(code, device, async (customPrice) => {
                    await assignDevice(code, customPrice);
                    // Scanner continues running - camera stays on
                    updateStatus('Added', 'success');
                });
            }
        }

        async function validateDevice(deviceId) {
            try {
                const response = await fetch(`/api/v1/devices/${deviceId}`);
                if (response.ok) {
                    const data = await response.json();
                    return data.device || null;
                }
                return null;
            } catch (error) {
                console.error('Error validating device:', error);
                return null;
            }
        }

        async function assignDevice(deviceId, customPrice) {
            try {
                const response = await fetch('/api/v1/jobs/{{.job.JobID}}/assign-device', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        job_id: {{.job.JobID}},
                        device_id: deviceId,
                        price: customPrice || null
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    addScanResult(deviceId, 'success', 'Device assigned successfully');
                    updateStatus('Added successfully', 'success');
                    // Don't reload page - keep camera running
                } else {
                    addScanResult(deviceId, 'error', result.error || 'Failed to assign device');
                    updateStatus('Assignment failed', 'error');
                }
            } catch (error) {
                console.error('Error assigning device:', error);
                addScanResult(deviceId, 'error', 'Network error');
                updateStatus('Network error', 'error');
            }
        }

        function showPriceModal(deviceCode, device, callback) {
            priceModalCallback = callback;
            
            document.getElementById('modal-device-id').textContent = deviceCode;
            document.getElementById('modal-device-name').textContent = 
                device.product ? device.product.name : 'Unknown Product';
            document.getElementById('customPrice').value = '';
            
            if (device.product && device.product.itemcostperday) {
                document.getElementById('default-price-info').textContent = 
                    `Default price: €${device.product.itemcostperday.toFixed(2)} per day`;
            } else {
                document.getElementById('default-price-info').textContent = 'No default price set';
            }
            
            const modal = document.getElementById('priceModal');
            
            // Show modal
            modal.style.display = 'flex';
            
            // Ensure video stays visible after modal close
            const closeModal = function() {
                // Hide modal first
                modal.style.display = 'none';
                
                // Force video to stay visible after modal close
                const video = document.getElementById('scanner-video');
                if (video && video.srcObject) {
                    video.style.display = 'block';
                    video.style.visibility = 'visible';
                    video.style.opacity = '1';
                    video.style.zIndex = '1';
                    
                    // Make sure it's still playing
                    video.play().catch(e => console.log('Video play after modal:', e));
                }
            };
            
            // Add close event listeners
            const closeButtons = modal.querySelectorAll('.rc-modal-close');
            closeButtons.forEach(button => {
                button.onclick = closeModal;
            });
            modal.onclick = function(e) {
                if (e.target === modal) closeModal();
            };
        }

        function toggleBulkMode() {
            // Default to bulk mode since no UI controls are present
            isBulkMode = true;
            bulkDevices = [];
            console.log('Bulk mode enabled by default');
        }

        async function finishBulkScan() {
            if (bulkDevices.length === 0) {
                alert('No devices scanned in bulk mode.');
                return;
            }
            
            updateStatus(`Assigning ${bulkDevices.length} devices...`, 'info');
            
            let successCount = 0;
            
            for (const device of bulkDevices) {
                try {
                    const response = await fetch('/api/v1/jobs/{{.job.JobID}}/assign-device', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            job_id: {{.job.JobID}},
                            device_id: device.deviceId,
                            price: null
                        })
                    });
                    
                    if (response.ok) {
                        successCount++;
                    }
                } catch (error) {
                    console.error('Error assigning device:', device.deviceId, error);
                }
            }
            
            updateStatus(`Bulk scan complete: ${successCount} devices assigned`, 'success');
            bulkDevices = [];
            setTimeout(() => window.location.reload(), 2000);
        }

        function processManualInput() {
            const input = document.getElementById('manual-input');
            const code = input.value.trim();
            
            if (code) {
                processScannedCode(code);
                input.value = '';
            }
        }

        async function removeDevice(deviceId) {
            if (!confirm('Remove this device from the job?')) return;
            
            try {
                const response = await fetch('/api/v1/jobs/{{.job.JobID}}/devices/' + deviceId, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    window.location.reload();
                } else {
                    alert('Failed to remove device');
                }
            } catch (error) {
                alert('Network error');
            }
        }

        function addScanResult(deviceId, type, message) {
            const deviceList = document.getElementById('device-list');
            const emptyState = document.getElementById('empty-state');
            
            if (emptyState) {
                emptyState.remove();
            }
            
            const resultDiv = document.createElement('div');
            resultDiv.className = `scan-result ${type}`;
            resultDiv.innerHTML = `
                <div class="rc-flex rc-flex-between rc-flex-start">
                    <div>
                        <div class="device-id">${deviceId}</div>
                        <div class="device-name">${message}</div>
                    </div>
                    ${type === 'success' ? 
                        `<button class="rc-btn rc-btn-outline-danger rc-btn-sm" onclick="removeDevice('${deviceId}')">
                            <i class="bi bi-trash"></i>
                        </button>` : ''
                    }
                </div>
            `;
            
            deviceList.insertBefore(resultDiv, deviceList.firstChild);
            
            // Remove after 5 seconds if it's an error
            if (type === 'error') {
                setTimeout(() => {
                    if (resultDiv.parentNode) {
                        resultDiv.remove();
                    }
                }, 5000);
            }
        }

        function updateStatus(message, type) {
            const statusElement = document.getElementById('scanner-status');
            if (statusElement) {
                statusElement.textContent = message;
                
                // Remove existing color classes
                statusElement.classList.remove('text-success', 'text-danger', 'text-warning', 'text-info');
                
                // Add appropriate color class
                if (type === 'success') statusElement.classList.add('text-success');
                else if (type === 'error') statusElement.classList.add('text-danger');
                else if (type === 'warning') statusElement.classList.add('text-warning');
                else if (type === 'info') statusElement.classList.add('text-info');
            }
        }

        // Case scanning functions
        async function processCaseCode(code) {
            // Extract case ID from the code
            let caseId;
            if (code.startsWith('CASE:')) {
                caseId = parseInt(code.substring(5));
            } else {
                caseId = parseInt(code);
            }
            
            if (isNaN(caseId)) {
                updateStatus('Invalid case code: ' + code, 'error');
                return;
            }
            
            // Find the case in our available cases
            const availableCases = [{{range .cases}}{{.CaseID}},{{end}}];
            if (!availableCases.includes(caseId)) {
                updateStatus('Case not found: ' + caseId, 'error');
                addScanResult(code, 'error', 'Case not found');
                setTimeout(() => updateStatus('Ready for next scan', 'success'), 2000);
                return;
            }
            
            // Assign all devices in the case
            await scanCase(caseId, 'Scanned Case', 0);
        }

        async function scanCase(caseId, caseName, deviceCount) {
            updateStatus('Scanning case: ' + caseName + '...', 'info');
            
            try {
                const response = await fetch('/api/v1/jobs/{{.job.JobID}}/assign-case', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        job_id: {{.job.JobID}},
                        case_id: caseId
                    })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    updateStatus('Case scanned successfully!', 'success');
                    addScanResult('CASE:' + caseId, 'success', 
                        `${result.case_name}: ${result.success_count} devices assigned` + 
                        (result.error_count > 0 ? `, ${result.error_count} errors` : ''));
                    
                    // Show detailed results if there were errors
                    if (result.results && result.error_count > 0) {
                        result.results.forEach(deviceResult => {
                            if (!deviceResult.success) {
                                addScanResult(deviceResult.device_id, 'error', deviceResult.message);
                            }
                        });
                    }
                    
                    // Reload page after 3 seconds to show new devices
                    setTimeout(() => window.location.reload(), 3000);
                } else {
                    updateStatus('Case scan failed: ' + result.error, 'error');
                    addScanResult('CASE:' + caseId, 'error', result.error || 'Case scan failed');
                }
            } catch (error) {
                console.error('Error scanning case:', error);
                updateStatus('Network error during case scan', 'error');
                addScanResult('CASE:' + caseId, 'error', 'Network error');
            }
        }

        function toggleAllCases() {
            const allCases = document.getElementById('all-cases');
            const toggleIcon = document.getElementById('cases-toggle-icon');
            
            if (allCases.style.display === 'none') {
                allCases.style.display = 'block';
                toggleIcon.className = 'bi bi-chevron-up';
                event.target.innerHTML = '<i class="bi bi-chevron-up" id="cases-toggle-icon"></i> Show less';
            } else {
                allCases.style.display = 'none';
                toggleIcon.className = 'bi bi-chevron-down';
                event.target.innerHTML = '<i class="bi bi-chevron-down" id="cases-toggle-icon"></i> Show all {{len .cases}} cases';
            }
        }

        // Accordion toggle function
        function toggleAccordion(targetId) {
            const target = document.getElementById(targetId);
            const button = document.querySelector(`[aria-controls="${targetId}"]`);
            
            if (target.classList.contains('show')) {
                target.classList.remove('show');
                button.classList.add('collapsed');
                button.setAttribute('aria-expanded', 'false');
            } else {
                target.classList.add('show');
                button.classList.remove('collapsed');
                button.setAttribute('aria-expanded', 'true');
            }
        }
        
        // Global escape key handler
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const modal = document.getElementById('priceModal');
                if (modal) {
                    modal.style.display = 'none';
                }
            }
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', function() {
            stopScanner();
        });
    </script>

    <!-- JavaScript -->
    <script src="/static/js/rental-core-design.js"></script>
</body>
</html>