{{define "company_settings_standalone.html"}}
<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}} - RentalCore</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="/static/css/app-new.css" rel="stylesheet">
    <link rel="manifest" href="/static/manifest.json">
    <meta name="theme-color" content="#1e293b">
</head>
<body class="animate-fade-in">
    <!-- Professional Navigation Bar -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="bi bi-gear-wide-connected"></i> RentalCore
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <div class="navbar-nav me-auto">
                    <a class="nav-link" href="/jobs">
                        <i class="bi bi-briefcase"></i> Jobs
                    </a>
                    <a class="nav-link" href="/devices">
                        <i class="bi bi-cpu"></i> Devices
                    </a>
                    <a class="nav-link" href="/customers">
                        <i class="bi bi-people"></i> Customers
                    </a>
                    <a class="nav-link" href="/cases">
                        <i class="bi bi-box"></i> Cases
                    </a>
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="toolsDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-tools"></i> Tools
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="toolsDropdown">
                            <li><h6 class="dropdown-header">Management</h6></li>
                            <li><a class="dropdown-item" href="/workflow/templates"><i class="bi bi-file-earmark-text"></i> Job Templates</a></li>
                            <li><a class="dropdown-item" href="/workflow/packages"><i class="bi bi-box-seam"></i> Equipment Packages</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Business</h6></li>
                            <li><a class="dropdown-item" href="/invoices"><i class="bi bi-file-text"></i> Invoices</a></li>
                            <li><a class="dropdown-item" href="/analytics"><i class="bi bi-graph-up"></i> Analytics</a></li>
                            <li><a class="dropdown-item" href="/financial"><i class="bi bi-calculator"></i> Financial</a></li>
                            <li><a class="dropdown-item" href="/documents"><i class="bi bi-file-earmark"></i> Documents</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><h6 class="dropdown-header">Utilities</h6></li>
                            <li><a class="dropdown-item" href="/search/global"><i class="bi bi-search"></i> Advanced Search</a></li>
                            <li><a class="dropdown-item" href="/workflow/bulk"><i class="bi bi-gear"></i> Bulk Operations</a></li>
                        </ul>
                    </div>
                </div>
                <div class="navbar-nav">
                    <a href="/scan/select" class="btn btn-outline-primary-enhanced btn-sm me-2" title="Launch Scanner">
                        <i class="bi bi-qr-code-scan me-1"></i> Scan
                    </a>
                    <button class="btn btn-outline-light btn-sm me-2" onclick="toggleTheme()" title="Toggle theme">
                        <i class="bi bi-moon-fill" id="theme-icon"></i>
                    </button>
                    {{if .user}}
                    <div class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-person-circle"></i> {{.user.Username}}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                            <li><h6 class="dropdown-header">
                                <i class="bi bi-person"></i> {{.user.FirstName}} {{.user.LastName}}
                            </h6></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/settings/company">
                                <i class="bi bi-building"></i> Company Settings
                            </a></li>
                            <li><a class="dropdown-item" href="/settings/email-templates">
                                <i class="bi bi-envelope-gear"></i> E-Mail Templates
                            </a></li>
                            <li><a class="dropdown-item" href="/users">
                                <i class="bi bi-people-fill"></i> User Management
                            </a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="/logout">
                                <i class="bi bi-box-arrow-right"></i> Logout
                            </a></li>
                        </ul>
                    </div>
                    {{else}}
                    <a class="btn btn-primary btn-sm" href="/login">
                        <i class="bi bi-box-arrow-in-right"></i> Login
                    </a>
                    {{end}}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main id="main-content" class="container-fluid mt-4 animate-slide-up" tabindex="-1">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3 class="card-title">üè¢ Firmeneinstellungen</h3>
                            <a href="/invoices" class="btn btn-secondary">
                                <i class="bi bi-file-text"></i> Zu den Rechnungen
                            </a>
                        </div>
                        <div class="card-body">
                            <form id="companySettingsForm" method="POST" enctype="multipart/form-data" action="/settings/company/api">
                                <input type="hidden" name="_method" value="PUT">
                                
                                <!-- Firmeninformationen -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h4 class="text-primary mb-3">
                                            <i class="bi bi-building"></i> Firmeninformationen
                                        </h4>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="companyName" class="form-label">Firmenname *</label>
                                        <input type="text" class="form-control" id="companyName" name="name" 
                                               value="{{.company.CompanyName}}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="legalForm" class="form-label">Rechtsform</label>
                                        <input type="text" class="form-control" id="legalForm" name="legal_form" 
                                               value="{{if .company.CompanyType}}{{.company.CompanyType}}{{end}}" placeholder="z.B. GmbH, AG, e.K.">
                                    </div>
                                </div>

                                <!-- Adresse -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h4 class="text-primary mb-3">
                                            <i class="bi bi-geo-alt"></i> Firmenadresse
                                        </h4>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-8">
                                        <label for="street" class="form-label">Stra√üe und Hausnummer *</label>
                                        <input type="text" class="form-control" id="street" name="street" 
                                               value="{{if .company.AddressLine1}}{{.company.AddressLine1}}{{end}}" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label for="postalCode" class="form-label">Postleitzahl *</label>
                                        <input type="text" class="form-control" id="postalCode" name="postal_code" 
                                               value="{{.company.PostalCode}}" required>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="city" class="form-label">Stadt *</label>
                                        <input type="text" class="form-control" id="city" name="city" 
                                               value="{{.company.City}}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="country" class="form-label">Land</label>
                                        <input type="text" class="form-control" id="country" name="country" 
                                               value="{{if .company.Country}}{{.company.Country}}{{else}}Deutschland{{end}}">
                                    </div>
                                </div>

                                <!-- Kontaktdaten -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h4 class="text-primary mb-3">
                                            <i class="bi bi-telephone"></i> Kontaktdaten
                                        </h4>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="phone" class="form-label">Telefon</label>
                                        <input type="tel" class="form-control" id="phone" name="phone" 
                                               value="{{if .company.Phone}}{{.company.Phone}}{{end}}">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="fax" class="form-label">Fax</label>
                                        <input type="tel" class="form-control" id="fax" name="fax" 
                                               value="{{if .company.Fax}}{{.company.Fax}}{{end}}">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="email" class="form-label">E-Mail *</label>
                                        <input type="email" class="form-control" id="email" name="email" 
                                               value="{{if .company.Email}}{{.company.Email}}{{end}}" required>
                                    </div>
                                    <div class="col-md-6">
                                        <label for="website" class="form-label">Website</label>
                                        <input type="url" class="form-control" id="website" name="website" 
                                               value="{{if .company.Website}}{{.company.Website}}{{end}}" placeholder="https://example.com">
                                    </div>
                                </div>

                                <!-- Firmendaten -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h4 class="text-primary mb-3">
                                            <i class="bi bi-card-text"></i> Firmendaten
                                        </h4>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="taxNumber" class="form-label">Steuernummer</label>
                                        <input type="text" class="form-control" id="taxNumber" name="tax_number" 
                                               value="{{if .company.TaxNumber}}{{.company.TaxNumber}}{{end}}" placeholder="z.B. 123/456/78901">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="vatNumber" class="form-label">USt-IdNr.</label>
                                        <input type="text" class="form-control" id="vatNumber" name="vat_number" 
                                               value="{{if .company.VATNumber}}{{.company.VATNumber}}{{end}}" placeholder="z.B. DE123456789">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="commercialRegister" class="form-label">Handelsregister</label>
                                        <input type="text" class="form-control" id="commercialRegister" name="commercial_register" 
                                               value="{{if .company.RegisterNumber}}{{.company.RegisterNumber}}{{end}}" placeholder="z.B. HRB 12345">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="managingDirector" class="form-label">Gesch√§ftsf√ºhrer</label>
                                        <input type="text" class="form-control" id="managingDirector" name="managing_director" 
                                               value="{{if .company.CEOName}}{{.company.CEOName}}{{end}}">
                                    </div>
                                </div>

                                <!-- Bankdaten -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h4 class="text-primary mb-3">
                                            <i class="bi bi-bank"></i> Bankverbindung
                                        </h4>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="bankName" class="form-label">Bank</label>
                                        <input type="text" class="form-control" id="bankName" name="bank_name" 
                                               value="{{if .company.BankName}}{{.company.BankName}}{{end}}" placeholder="z.B. Sparkasse Musterstadt">
                                    </div>
                                    <div class="col-md-6">
                                        <label for="iban" class="form-label">IBAN</label>
                                        <input type="text" class="form-control" id="iban" name="iban" 
                                               value="{{if .company.IBAN}}{{.company.IBAN}}{{end}}" placeholder="z.B. DE89 3704 0044 0532 0130 00">
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="bic" class="form-label">BIC</label>
                                        <input type="text" class="form-control" id="bic" name="bic" 
                                               value="{{if .company.BIC}}{{.company.BIC}}{{end}}" placeholder="z.B. COBADEFFXXX">
                                    </div>
                                </div>

                                <!-- Logo Upload -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h4 class="text-primary mb-3">
                                            <i class="bi bi-image"></i> Firmenlogo
                                        </h4>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-6">
                                        <label for="logo" class="form-label">Logo hochladen</label>
                                        <input type="file" class="form-control" id="logo" name="logo" 
                                               accept="image/*" onchange="previewLogo(this)">
                                        <div class="form-text">Unterst√ºtzte Formate: JPG, PNG, GIF (max. 2MB)</div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="text-center">
                                            <div id="logoPreview" class="mt-2">
                                                {{if .company.LogoPath}}
                                                    <img src="{{.company.LogoPath}}" alt="Firmenlogo" 
                                                         class="img-thumbnail" style="max-height: 150px;">
                                                    <div class="mt-2">
                                                        <button type="button" class="btn btn-sm btn-danger" onclick="deleteLogo()">
                                                            <i class="bi bi-trash"></i> Logo l√∂schen
                                                        </button>
                                                    </div>
                                                {{else}}
                                                    <div class="border border-dashed p-4 text-muted">
                                                        <i class="bi bi-image" style="font-size: 2rem;"></i>
                                                        <div>Kein Logo hochgeladen</div>
                                                    </div>
                                                {{end}}
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Zus√§tzliche Informationen -->
                                <div class="row mb-4">
                                    <div class="col-md-12">
                                        <h4 class="text-primary mb-3">
                                            <i class="bi bi-info-circle"></i> Zus√§tzliche Informationen
                                        </h4>
                                    </div>
                                </div>

                                <div class="row mb-3">
                                    <div class="col-md-12">
                                        <label for="notes" class="form-label">Notizen</label>
                                        <textarea class="form-control" id="notes" name="notes" rows="3" 
                                                  placeholder="Zus√§tzliche Firmeninformationen...">{{.company.Notes}}</textarea>
                                    </div>
                                </div>

                                <!-- Buttons -->
                                <div class="row">
                                    <div class="col-md-12">
                                        <hr>
                                        <div class="d-flex justify-content-between">
                                            <a href="/invoices" class="btn btn-secondary">
                                                <i class="bi bi-arrow-left"></i> Zur√ºck zu den Rechnungen
                                            </a>
                                            <div>
                                                <button type="button" class="btn btn-outline-secondary me-2" onclick="resetForm()">
                                                    <i class="bi bi-arrow-clockwise"></i> Zur√ºcksetzen
                                                </button>
                                                <button type="submit" class="btn btn-primary">
                                                    <i class="bi bi-save"></i> Speichern
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Professional Footer -->
    <footer class="mt-auto">
        <div class="container-fluid text-center">
            <div class="row align-items-center py-3">
                <div class="col-md-6 text-md-start">
                    <small class="text-muted">
                        <i class="bi bi-gear-wide-connected me-1"></i>
                        RentalCore - The core of your rental business
                    </small>
                </div>
                <div class="col-md-6 text-md-end">
                    <small class="text-muted">
                        <i class="bi bi-code-slash me-1"></i>
                        Professional Theme 3.0
                    </small>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/app.js"></script>
    <script src="/static/js/ui-enhancements.js"></script>
    
    <script>
        // Theme toggle functionality
        function toggleTheme() {
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            const currentTheme = html.getAttribute('data-theme');
            
            if (currentTheme === 'dark') {
                html.setAttribute('data-theme', 'light');
                themeIcon.className = 'bi bi-sun-fill';
                localStorage.setItem('theme', 'light');
            } else {
                html.setAttribute('data-theme', 'dark');
                themeIcon.className = 'bi bi-moon-fill';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Load saved theme
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme') || 'dark';
            const html = document.documentElement;
            const themeIcon = document.getElementById('theme-icon');
            
            html.setAttribute('data-theme', savedTheme);
            if (savedTheme === 'light') {
                themeIcon.className = 'bi bi-sun-fill';
            }
        });

        // Form handling
        document.getElementById('companySettingsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            
            fetch('/settings/company/api', {
                method: 'PUT',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showToast('Firmeneinstellungen erfolgreich gespeichert!', 'success');
                } else {
                    showToast('Fehler beim Speichern: ' + (data.error || 'Unbekannter Fehler'), 'danger');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showToast('Fehler beim Speichern der Einstellungen', 'danger');
            });
        });

        // Logo preview
        function previewLogo(input) {
            const preview = document.getElementById('logoPreview');
            
            if (input.files && input.files[0]) {
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <img src="${e.target.result}" alt="Logo Vorschau" 
                             class="img-thumbnail" style="max-height: 150px;">
                        <div class="mt-2">
                            <button type="button" class="btn btn-sm btn-danger" onclick="clearLogoPreview()">
                                <i class="bi bi-trash"></i> Vorschau l√∂schen
                            </button>
                        </div>
                    `;
                };
                
                reader.readAsDataURL(input.files[0]);
            }
        }

        // Clear logo preview
        function clearLogoPreview() {
            document.getElementById('logoPreview').innerHTML = `
                <div class="border border-dashed p-4 text-muted">
                    <i class="bi bi-image" style="font-size: 2rem;"></i>
                    <div>Kein Logo hochgeladen</div>
                </div>
            `;
            document.getElementById('logo').value = '';
        }

        // Delete logo
        function deleteLogo() {
            if (confirm('M√∂chten Sie das Firmenlogo wirklich l√∂schen?')) {
                fetch('/settings/company/logo', {
                    method: 'DELETE'
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Logo erfolgreich gel√∂scht!', 'success');
                        clearLogoPreview();
                    } else {
                        showToast('Fehler beim L√∂schen des Logos: ' + (data.error || 'Unbekannter Fehler'), 'danger');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast('Fehler beim L√∂schen des Logos', 'danger');
                });
            }
        }

        // Reset form
        function resetForm() {
            if (confirm('M√∂chten Sie alle √Ñnderungen zur√ºcksetzen?')) {
                location.reload();
            }
        }

        // Basic toast function
        function showToast(message, type, duration = 3000) {
            const toast = document.createElement('div');
            toast.className = `alert alert-${type} position-fixed top-0 end-0 m-3`;
            toast.style.zIndex = '9999';
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, duration);
        }
    </script>
</body>
</html>
{{end}}